C51 COMPILER V9.60.7.0   SHUMA                                                             03/12/2024 17:30:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE SHUMA
OBJECT MODULE PLACED IN .\Objects\shuma.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE shuma.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\shu
                    -ma.lst) OBJECT(.\Objects\shuma.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #include "typedef.h"
   3          
   4          u8 shumatmp[8]={23,23,23,23,23,23,23,23};//数码管缓冲区
   5          
   6          //共阳数码管段码表(考试会给的吧)
   7          //code代表放入只读存储器
   8          u8 code LedChar[] = {
   9                  0xC0, 0xF9, 0xA4, 0xB0,//0    0  1  2  3
  10                  0x99, 0x92, 0x82, 0xF8,//4    4  5  6  7
  11                  0x80, 0x90, 0x88, 0x83,//8    8  9  A  b
  12                  0xC6, 0xA1, 0x86, 0x8E,//12   C  d  E  F
  13                  0x89, 0xC7, 0xC8, 0x8c,//16   H  L  N  P
  14                  0xC1, 0xbf, 0x7f, 0xff,//20   U  -  .  null
  15          }; 
  16          
  17          //单字节数码管显示(直接输入数字，在中断调用)
  18          //locate：1-8  number：1-23
  19          //如果要加点，增加if：locate判断，&0x7f
  20          void shuma(u8 locate,u8 number)
  21          {
  22   1              //清零
  23   1              P2=(P2&0x1f)|0xe0;
  24   1              P0=0xff;
  25   1              P2&=0x1f;
  26   1              //数码管位选（1亮）   y6c
  27   1              P2=(P2&0x1f)|0xc0;
  28   1              P0=(0x01<<(locate-1));
  29   1              P2&=0x1f;
  30   1              //数码管段选（0亮）   y7c
  31   1              P2=(P2&0x1f)|0xe0;
  32   1              P0=LedChar[number];
  33   1              P2&=0x1f;
  34   1      }
  35          
  36          //数码管辅助多位整数显示（起始位置，u32整数）
  37          //把值填入缓存数组，放入中断更新数组  locate：1-8
  38          void warma(u8 locate,u32 num)
  39          {
  40   1              char i,j=0;
  41   1              u8 shark[8];
  42   1              for(i=0;i<8;i++)
  43   1              {
  44   2                      shark[i]=num%10;
  45   2                      num/=10;
  46   2              }
  47   1              for(i=7;i>=0;i--)
  48   1              {
  49   2                      if(shark[i]==0){shumatmp[i]=23;j++;}
  50   2                      else break;
  51   2              }
  52   1              for(;i>=0;i--)
  53   1              {
  54   2                      shumatmp[6-j-i+locate] = shark[i];
C51 COMPILER V9.60.7.0   SHUMA                                                             03/12/2024 17:30:06 PAGE 2   

  55   2              }
  56   1      }
  57          
  58          //数码管扫描，用于中断函数，实现多位显示
  59          void shumascan()
  60          {
  61   1              static u8 count = 0;
  62   1              count++;
  63   1              switch(count)
  64   1              {
  65   2                      case 1:
  66   2                              shuma(1,shumatmp[0]);
  67   2                              break;
  68   2                      case 2:
  69   2                              shuma(2,shumatmp[1]);
  70   2                              break;
  71   2                      case 3:
  72   2                              shuma(3,shumatmp[2]);
  73   2                              break;
  74   2                      case 4:
  75   2                              shuma(4,shumatmp[3]);
  76   2                              break;
  77   2                      case 5:
  78   2                              shuma(5,shumatmp[4]);
  79   2                              break;
  80   2                      case 6:
  81   2                              shuma(6,shumatmp[5]);
  82   2                              break;
  83   2                      case 7:
  84   2                              shuma(7,shumatmp[6]);
  85   2                              break;
  86   2                      case 8:
  87   2                              shuma(8,shumatmp[7]);
  88   2                              count = 0;
  89   2                              break;
  90   2              }
  91   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
