C51 COMPILER V9.60.7.0   DS18B20                                                           03/30/2024 14:49:07 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Objects\ds18b20.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ds18b20.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\d
                    -s18b20.lst) OBJECT(.\Objects\ds18b20.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #include "onewire.h"
*** WARNING C318 IN LINE 2 OF ds18b20.c: can't open file 'onewire.h'
   3          #include "typedef.h"
   4          
   5          //用到的rom命令
   6          #define skip_rom 0xcc
   7          //用到的功能命令
   8          #define convent_t 0x44
   9          #define read_scratchpad 0xbe
  10          
  11          //简单读取函数~
  12          float ds18b20_read_tempeture()
  13          {
  14   1              unsigned int temp;
  15   1              float tempeture;
  16   1              unsigned char low,high;
  17   1              //convent_t
  18   1              init_ds18b20();
*** WARNING C206 IN LINE 18 OF ds18b20.c: 'init_ds18b20': missing function-prototype
  19   1              Write_DS18B20(skip_rom);
*** WARNING C206 IN LINE 19 OF ds18b20.c: 'Write_DS18B20': missing function-prototype
*** ERROR C267 IN LINE 19 OF ds18b20.c: 'Write_DS18B20': requires ANSI-style prototype
  20   1              Write_DS18B20(convent_t);
  21   1              Delay_OneWire(200);//2ms
  22   1              //read_scratchpad
  23   1              init_ds18b20();
  24   1              Write_DS18B20(skip_rom);
  25   1              Write_DS18B20(read_scratchpad);
  26   1              
  27   1              low = Read_DS18B20();
  28   1              high = Read_DS18B20();
  29   1              
  30   1              //整合数据，0.0625精度
  31   1              if(high>10)//负数
  32   1              {
  33   2                      high &= 0x07;
  34   2                      temp = (high<<8)|low;
  35   2                  tempeture = -(temp*0.0625);
  36   2              }
  37   1              else
  38   1              {
  39   2                      temp = (high<<8)|low;
  40   2                      tempeture = temp*0.0625;
  41   2              }
  42   1      
  43   1              return tempeture;
  44   1      }
  45          
  46          //温度在数码管显示(ctrl.c)
  47          void ds18b20_show()
  48          {
  49   1              float temp;
  50   1              u32 te;
C51 COMPILER V9.60.7.0   DS18B20                                                           03/30/2024 14:49:07 PAGE 2   

  51   1              temp = ds18b20_read_tempeture();
  52   1              if(temp<0) {shumatmp[0]=0xbf; temp = 0-temp;}
  53   1              te = (u32)(temp*10000);
  54   1              shumatmp[0]=te/1000000;
  55   1              shumatmp[1]=te%1000000/100000;
  56   1              shumatmp[2]=te%100000/10000;
  57   1              //加小数点
  58   1              shumatmp[4]=te%10000/1000;
  59   1              shumatmp[5]=te%1000/100;
  60   1              shumatmp[6]=te%100/10;
  61   1              shumatmp[7]=te%10;
  62   1      }

C51 COMPILATION COMPLETE.  3 WARNING(S),  1 ERROR(S)
