C51 COMPILER V9.60.7.0   4KEY                                                              04/03/2024 10:21:21 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE 4KEY
OBJECT MODULE PLACED IN .\Objects\4key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 4key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\4key
                    -.lst) OBJECT(.\Objects\4key.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #include "shuma.h"
   3          #include "typedef.h"
   4          
   5          //独立按键用此声明
   6          //读出的值为0即为按下
   7          sbit KEY_IN_1 = P3^3;sbit KEY_IN_2 = P3^2;sbit KEY_IN_3 = P3^1;sbit KEY_IN_4 = P3^0;
   8          
   9          extern u8 num;
  10          
  11          //按键行为函数
  12          void keyaction4(u8 i)
  13          {
  14   1              switch(i)
  15   1              {
  16   2                      case 0:num = 0x00;break;
  17   2                      case 1:num = 0x01;break;
  18   2                      case 2:num = 0x02;break;
  19   2                      case 3:num = 0x03;break;
  20   2              }
  21   1      }
  22          
  23          //独立按键扫描函数(在中断调用)
  24          void keyscan4()
  25          {
  26   1              u8 i;
  27   1              //2*8ms延时判断
  28   1              static u8 keytmp[4] = {0xff,0xff,0xff,0xff};
  29   1              //防止重复对比
  30   1              static u8 keyold[4] = {1,1,1,1};
  31   1              static u8 keynow[4] = {1,1,1,1};
  32   1      
  33   1              keytmp[0] = (keytmp[0]<<1)| KEY_IN_1;
  34   1              keytmp[1] = (keytmp[1]<<1)| KEY_IN_2;
  35   1              keytmp[2] = (keytmp[2]<<1)| KEY_IN_3;
  36   1              keytmp[3] = (keytmp[3]<<1)| KEY_IN_4;
  37   1              
  38   1              for(i=0;i<4;i++)
  39   1              {
  40   2                      if(keytmp[i] == 0xff)
  41   2                      {
  42   3                              keynow[i] = 1;
  43   3                      }
  44   2                      else if(keytmp[i] == 0x00)
  45   2                      {
  46   3                              keynow[i] = 0;
  47   3                      }
  48   2                      else {}
  49   2              }
  50   1              for(i=0;i<4;i++)
  51   1              {
  52   2                      if(keynow[i]!=keyold[i])
  53   2                      {
  54   3                              if(keynow[i]==0)
C51 COMPILER V9.60.7.0   4KEY                                                              04/03/2024 10:21:21 PAGE 2   

  55   3                              {
  56   4                                      keyaction4(i);
  57   4                              }
  58   3                              keyold[i]=keynow[i];
  59   3                      }
  60   2              }
  61   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    152    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
