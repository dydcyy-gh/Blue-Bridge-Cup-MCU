C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 16:17:51 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          
   3          typedef unsigned char u8; //0-255    0x00 - 0xff
   4          typedef unsigned int u16; //0-65535  0x0000 - 0xffff
   5          typedef unsigned long u32;
   6          
   7          u8 T1H;
   8          u8 T1L;
   9          
  10          void p0init();
  11          void led(u8 locate);
  12          void buzz();
  13          void relay();
  14          void shuma(u8 locate,u8 number);
  15          void timer1init(u8 ms);
  16          
  17          //共阳数码管段码表(考试会给的吧)
  18          u8 code LedChar[] = {
  19                  0xC0, 0xF9, 0xA4, 0xB0,//0-3
  20                  0x99, 0x92, 0x82, 0xF8,//4-7
  21                  0x80, 0x90, 0x88, 0x83,//8-b
  22                  0xC6, 0xA1, 0x86, 0x8E,//C-F
  23          }; 
  24          
  25          void main()
  26          {
  27   1              p0init();
  28   1              timer1init(2);
  29   1              while(1)
  30   1              {
  31   2                      
  32   2              }
  33   1      }
  34          
  35          //用于关闭p0口的所有外设
  36          void p0init()
  37          {
  38   1              //关闭led！  y4c
  39   1              P2=(P2&0x1f)|0x80;
  40   1              P0=0xff;
  41   1              P2&=0x1f;
  42   1              //关闭蜂鸣器继电器   y5c
  43   1              P2=(P2&0x1f)|0xa0;
  44   1              P06=0;//蜂鸣器
  45   1              P04=0;//继电器
  46   1              P2&=0x1f;
  47   1              //初始化数码管（全灭）
  48   1              P2=(P2&0x1f)|0xc0;  //y6c
  49   1              P0=0xff;
  50   1              P2&=0x1f;
  51   1              P2=(P2&0x1f)|0xe0;  //y7c
  52   1              P0=0xff;
  53   1              P2&=0x1f;
  54   1      }
C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 16:17:51 PAGE 2   

  55          
  56          //基础led
  57          void led(u8 locate)//0亮
  58          {
  59   1              P2=(P2&0x1f)|0x80;
  60   1              P0=locate;
  61   1              P2&=0x1f;
  62   1      }
  63          
  64          //打开蜂鸣器
  65          void buzz()
  66          {
  67   1              P2=(P2&0x1f)|0xa0;
  68   1              P06=1;//蜂鸣器
  69   1              P04=0;//继电器
  70   1              P2&=0x1f;
  71   1      }
  72          
  73          //打开继电器
  74          void relay()
  75          {
  76   1              P2=(P2&0x1f)|0xa0;
  77   1              P04=1;//继电器
  78   1              P06=0;//蜂鸣器
  79   1              P2&=0x1f;
  80   1      }
  81          
  82          
  83          //数码管显示
  84          void shuma(u8 locate,u8 number)
  85          {
  86   1              //清零
  87   1              P2=(P2&0x1f)|0xe0;
  88   1              P0=0xff;
  89   1              P2&=0x1f;
  90   1              //数码管位选（1亮）   y6c
  91   1              P2=(P2&0x1f)|0xc0;
  92   1              P0=(0x01<<(locate-1));
  93   1              P2&=0x1f;
  94   1              //数码管段选（0亮）   y7c
  95   1              P2=(P2&0x1f)|0xe0;
  96   1              P0=LedChar[number];
  97   1              P2&=0x1f;
  98   1      }
  99          
 100          
 101          //定时器1 模式1 (16位自动重载)
 102          //@12hz xms 12t (12分频) 低速模式
 103          void timer1init(u8 ms)
 104          {
 105   1              u32 tmp;
 106   1              //计算得出TL TH的值
 107   1              tmp = 12000000/12;  //每s 计数TMP次
 108   1              tmp = (tmp*ms)/1000;//每ms计数TMP次
 109   1              tmp = 65536 - tmp;
 110   1              T1H = (u8)(tmp>>8); //tmp / 256
 111   1              T1L = (u8)tmp;      //tmp % 256
 112   1              //AUXR在12t模式时可省略
 113   1              AUXR &= 0xBF;
 114   1              //TMOD
 115   1              TMOD &= 0x0F;           //设置定时器模式
 116   1              //TH TL
C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 16:17:51 PAGE 3   

 117   1              TH1 = T1H;              //设置定时初始值
 118   1              TL1 = T1L;                              
 119   1              //TCON
 120   1              TF1 = 0;                        //清除TF0标志
 121   1              TR1 = 1;                        //定时器0开始计时
 122   1              //interupt
 123   1              ET1 = 1;            //中断允许位
 124   1              EA = 1;             //cpu中断允许位
 125   1              PT1 = 0;            //优先级0(最低)
 126   1      }
 127          
 128          void interrupttimer1() interrupt 3
 129          {
 130   1              static u8 count = 0;
 131   1          count++;
 132   1          switch(count)
 133   1          {
 134   2              case 1:
 135   2                  shuma(1,1);
 136   2                  break;
 137   2              case 2:
 138   2                  shuma(2,2);
 139   2                  break;
 140   2              case 3:
 141   2                  shuma(3,3);
 142   2                              count = 0;//最后一个case加
 143   2                  break;
 144   2              // 添加更多的case
 145   2              }
 146   1      }
 147          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    352    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
